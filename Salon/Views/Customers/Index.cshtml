@model IEnumerable<Salon.Models.CustomerViewModel>

@{
    ViewBag.Title = "Index";
}

<h2>Kunden</h2>


<input type="text" id="Search" placeholder="Search..">

    <div style="visibility: hidden">
        @Html.ActionLink("Search", "CustomerOverview", new { searchstring = "" }, new { @class = "customer-overview" })
    </div>

    <p>
        @Html.ActionLink("Create New", "Create")
    </p>

    <div id="CustomerMaster" style="height : 310px; overflow:auto; width: 100%;">
        <table class="table" id="tbl_cust">
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.GenderID)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.FName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.LName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.PostalCode)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.CityName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Street)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Country)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Description)
                </th>

                <th></th>
            </tr>

            @foreach (var item in Model) {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.GenderTitle)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FName)
                    </td>


                    <td>
                        @Html.DisplayFor(modelItem => item.LName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.PostalCode)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CityName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Street)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Country)
                    </td>


                    <td>
                        @Html.DisplayFor(modelItem => item.Description)
                    </td>


                    <td>
                        @Html.ActionLink("Edit", "Edit", new { id = item.CustomerId }) |
                        @Html.ActionLink("Details", "Details", new { id = item.CustomerId }) |
                        @Html.ActionLink("Besuche", "VisitShort", new { id = item.CustomerId }, new { @class = "customer-visitshort" }) |
                        @Html.ActionLink("Kontaktdaten", "CustomerConnection", new { id = item.CustomerId }, new { @class = "customer-connection" })
                    </td>
                </tr>
            }



        </table>
    </div>

@* in diesen Div werden die Kontaktdaten und Besuche eingefügt *@
    <div id="MasterDetail">

    </div>


    @section scripts {

        <script src="~/Scripts/jquery-1.10.2.min.js"></script>
        <script>

        </script>
        <script type="text/javascript">
            //Event wenn der Actionlink geklickt wird
            $(function () {
                $('body').on('click', '.customer-visitshort', function (e) {

                    //Session cusid
                    localStorage.setItem('cusid', $(this).prop('href'));

                    //Response im MasterDetail anzeigen
                    $.get($(this).prop('href'), function (response) {
                        $('#MasterDetail').html(response)
                    });
                    e.preventDefault();
                });
            });

            //Wenn der Actionlink geklickt wird
            $('body').on('click', '.customer-connection', function (e) {

                //Session cusid
                localStorage.setItem('cusid', $(this).prop('href'));

                //Response im MasterDetail anzeigen
                $.get($(this).prop('href'), function (response) {
                    $('#MasterDetail').html(response)
                });
                e.preventDefault();
            });

            //Wenn auf den Suchlink geklickt wird
            $(function () {
                $('.customer-overview').on('click', function (e) {
                    $.get($(this).prop('href'), function (response) {
                        //response in customermaster
                        $('#CustomerMaster').html(response)
                    });
                    e.preventDefault();
                });
            });

            //Suchstring generieren
            $("#Search").keyup(function (e) {

                var Searchtext = $("#Search").val().toLowerCase();


                $(".customer-overview").attr("href", "/Customers/CustomerOverview?searchstring=" + Searchtext);

                //Actionlink klicken
                document.querySelector('.customer-overview').click();
            });

            //Wenn die Seite geladen wird
            window.onload = function () {
                if (localStorage.getItem('cusid') != null) {
                    //get session cusid
                    var link = localStorage.getItem('cusid');
                    link = link.substring(21);
                    //klick actionlink
                    $("a[href$='" + link + "']").click();
                }
            };
        </script>
    }

